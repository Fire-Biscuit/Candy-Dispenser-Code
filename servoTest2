from threading import Thread
from time import sleep
from gpiozero import Servo
import paho.mqtt.client as mqtt

servo = Servo(15)
#mqttTopic = "schardm/test"
mqttTopic = "testtopic/tester"

mqttc = mqtt.Client()

def setup():

    def on_message(client, userdata, msg):
        print(msg.topic)
        if str(msg.topic) == mqttTopic:
            servoFunction()

    def on_connect(client, userdata, flags, rc):
        print("Connected with result code " + str(rc))

    def on_subscribe(client, obj, mid, granted_qos):
        print("Subscribed: " + str(mid) + " " + str(granted_qos))

    mqttc.username_pw_set("tester", "tester")
    mqttc.connect("mqtt-dashboard.com", port=8884)
    
    #mqttc.username_pw_set("schardm", "4Oyhf3DAoSzxYc9QciX8")
    #mqttc.connect("mqtt.hva-robots.nl", port=1883)
    
    mqttc.on_message = on_message
    mqttc.on_connect = on_connect
    mqttc.on_subscribe = on_subscribe
    mqttc.subscribe(mqttTopic)
    print(mqttc.is_connected)

def servoFunction():
        servo.min()
        print("begin")
        sleep(1)
        servo.max()
        print("eind")

def servoMain():
    setup()
    print("loop in")
    mqttc.loop_forever
    print("loop uit")
    mqttc.publish(mqttTopic, "message")

servoThread=Thread(target=servoMain)
servoThread.start()

while True:
    pass